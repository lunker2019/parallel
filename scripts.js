/* (c) Parallel Project, 2017 */

"use strict";function getStorage(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:STORAGE_KEY,c=JSON.parse(window.localStorage.getItem(b)||"{}");return c[a]||""}function setStorage(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:STORAGE_KEY,d=JSON.parse(window.localStorage.getItem(c)||"{}");d[a]=b,window.localStorage.setItem(c,JSON.stringify(d))}function $(a){return window.document.querySelector(a)}function $$(a){return Array.from(window.document.querySelectorAll(a))}function bindEvent(a,b,c){var d=!0,e=!1,f=void 0;try{for(var g,h=b.split(" ")[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;a.addEventListener(i,c)}}catch(j){e=!0,f=j}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}}function now(){var a=new Date;return a.toLocaleDateString()+" "+a.toLocaleTimeString()}var STORAGE_KEY=(window.location.pathname.match(/[\w\-]+/)||[""])[0];$$(".problem input[data-id]").forEach(function(a){var b=a.dataset.id,c=getStorage(b);c&&(a.value=c.value),bindEvent(a,"propertychange keyup input paste",function(){setStorage(b,{value:a.value,time:now()})})}),$$(".hint").forEach(function(a){var b=a.dataset.id;getStorage(b)?a.style.height="auto":a.addEventListener("click",function(){setStorage(b,{time:now()}),a.style.height=a.children[0].offsetHeight+"px"})});var URL="https://docs.google.com/a/mathigon.org/forms/d/e/1FAIpQLSdqYc7ulmgSofjULkPSx5xtF5fucfqxxCpTEMxbWWyLaLCrRg/formResponse",nameInput=$("#submit input"),submit=$("#submit button"),name=getStorage("name","shared");name&&(nameInput.value=name||""),bindEvent(nameInput,"propertychange keyup input paste",function(){setStorage("name",nameInput.value,"shared")}),submit.addEventListener("click",function(){if(!nameInput.value)return void alert("Please enter your username before submitting.");submit.textContent="Submitting…",submit.style.pointerEvents="none";var a=new XMLHttpRequest;a.onreadystatechange=function(){if(!(a.readyState<=3)){var b=a.status;b>=200&&b<300||304===b?submit.textContent="Done!":(alert("Something went wrong… Please try again!"),submit.textContent="Submit your Answers",submit.style.pointerEvents="auto")}},a.open("POST",URL,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var b=encodeURIComponent(window.localStorage.getItem(STORAGE_KEY)),c=encodeURIComponent(nameInput.value);a.send("entry.1217528920="+c+"&entry.1604250288="+b)});